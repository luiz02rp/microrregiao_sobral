---
title: "Microrregião de Sobral"
lang: pt
format:
  html:
    toc: true
    number-sections: true
    toc-depth: 2
    embed-resources: true
---

```{r}
#| include: false
#| message: false
#| warning: false

library(tidyverse)
library(janitor)
library(sf)
library(scales)
library(geobr)
library(readr)
library(plotly)
library(ggrepel)
library(viridis)
library(knitr)
library(tidyr)
```

```{r}
#| include: false
#| message: false
#| warning: false
# chamando banco de dados
# população do ceará
ce_municipios <- read_municipality(code_muni = "CE", year = 2024)
# população da micro sobral
pop_micro_sobral <- read_csv2("data/pop_ce_censo_2022_limpo.csv")
# mortalidade da micro sobral
mort_nascidos_vivos_micro_sobral <- read_csv2("data/mort_e_nascidosvivos_micro_sobral.csv") 
# equipamentos
equipamentos <- read_csv2("data/equipamentos_limpo.csv")
```

```{r}
#| include: false
#| message: false
#| warning: false
# tratamento dos dados
# população dos municípios da micro sobral
pop_micro_sobral <- pop_micro_sobral |> 
  clean_names() |> 
  as_tibble() |> 
  mutate(
    municipio = str_to_title(municipio),
    populacao = as.numeric(populacao),
    municipio = case_when(municipio == "Ipú" ~ "Ipu",
                           TRUE ~ municipio)
  ) |> 
  select(municipio, populacao)
   
# juntando bancos de dados
ce_municipios <- ce_municipios |> 
  mutate(
    name_muni = str_to_title(name_muni)) |> 
  inner_join(pop_micro_sobral, by = c("name_muni" = "municipio"))
```

```{r}
#| include: false
#| message: false
#| warning: false
# tratando banco de número de mortos e nascidos vivos
mort_nascidos_vivos_micro_sobral <- mort_nascidos_vivos_micro_sobral |> 
  clean_names()

mort_nascidos_vivos_micro_sobral |> 
   summarise(
    qde_morte_micro_sobral = sum(mort_nascidos_vivos_micro_sobral$qde_morte_micro_sobral),
    qde_nascidos_vivos_micro_sobral = sum(mort_nascidos_vivos_micro_sobral$qde_nascidos_vivos_micro_sobral)
  )
 
```

# Aspectos gerais


```{r}
#| echo: false

 a <- 658665/9233656
 a <- label_percent(accuracy = 0.001)(a)
```

A microrregião de Sobral é composta por 24 municípios. São eles: Alcântaras, Cariré, Catunda, Coreaú, Forquilha, Frecheirinha, Graça, Groaíras, Hidrolândia, Ipu, Irauçuba, Massapê, Meruoca, Moraújo, Mucambo, Pacujá, Pires Ferreira, Reriutaba, Santa Quitéria, Santana Do Acaraú, Senador Sá, Sobral, Uruoca e Varjota. Tais municípios totalizam 658.665 mil em termos populacionais o que representa 39,2% da população da macrorregião norte (1.679.525 milhões) e em torno de `r a`  da população do Ceará (9.233.656 milhões). (https://sidra.ibge.gov.br/tabela/6579).

=> colocar tabela aqui

## Gênero e distribuição populacional
Quando se realiza o recorte de gênero, nota-se que não há uma grande discrepância entre o quantitativo de homens (49%) e mulheres (51%) na microrregião de sobral. Sobral constitui o mais populoso dentre eles com 215.286 mil habitantes. Ipu o segundo lugar nesse posto com uma poulação estimada em 42.968 mil. Paculá, por outro lado, tem a menor população que gira em torno de 6.345 mil habitantes (https://sidra.ibge.gov.br/tabela/6579). 

A partir desses dados, constata-se uma desigual distribuição populacional. Tal discrepância pode ser verificada ao se ater à diferença já entre Ipú e Sobral que é de 172.318. Quando comparado com o menor município em termos populacionais (Pacujá), a diferença sobe para 208.941. 


```{r}
#| include: false
#| message: false
#| warning: false
# análise descritiva
pop_micro_sobral |> 
  summarise(
    qde_municipios = n(),
    total_populacao = sum(populacao),
    media = mean(populacao),
    mediana = median(populacao), 
    desvio_padrao = sd(populacao),
    valor_minimo = min(populacao),
    valor_maximo = max(populacao)
  )
```

```{r}
#| message: false
#| warning: false
#| echo: false
#| label: Gráfico de coluna

gra_col <- pop_micro_sobral |> 
  mutate(populacao_formatada = format(populacao, big.mark = ".", decimal.mark = ",")) |> 
  ggplot(
    aes(x = populacao,
        y = reorder(municipio, populacao),
        text = paste("Município:", municipio, "<br>População:", populacao_formatada)),
    color = "white"
  )+
  geom_col(fill = "grey")+
  labs(
    title = "Distribuição populacional por município",
    x = "População",
    y = "Municípios"
  )+
  # remover espaçamento entre o nome dos municípios e as colunas
  scale_x_continuous(expand = c(0,0),
                     breaks = c(6345, 42968, 215286),
                     limits = c(0, max(pop_micro_sobral$populacao)*1.02))+
  # remover fundo quadriculado
  theme(
    panel.background = element_blank(),
    axis.line.y = element_line(),
    axis.title.y = element_text(margin = margin(r = 15)),
    plot.margin = margin(l = 100, r = 20),
    axis.line.x = element_line()
  )
# tranformar em gráfico interativo
gra_col_int <- ggplotly(gra_col, tooltip = "text") |> 
  layout(margin = list(l = 120, r = 50, t = 50, b = 50),
         yaxis = list(
           title = list(standoff = 10)
         ))
gra_col_int
```
```{r}
#| echo: false
mortes <- sum(mort_nascidos_vivos_micro_sobral$mortes)
vivos <- sum(mort_nascidos_vivos_micro_sobral$nascidos_vivos)
# sobral
mortes_sobral <- mort_nascidos_vivos_micro_sobral[[22, 2]]
vivos_sobral <- mort_nascidos_vivos_micro_sobral[[22, 3]]
# ipu
mortes_ipu <- mort_nascidos_vivos_micro_sobral[[10, 2]]
vivos_ipu <- mort_nascidos_vivos_micro_sobral[[10, 3]]
# pacujá
mortes_pacuja <- mort_nascidos_vivos_micro_sobral[[16, 2]]
vivos_pacuja <- mort_nascidos_vivos_micro_sobral[[16, 3]]

## formatar para texto
# geral
mortes <- number(mortes, big.mark = ".", decimal.mark = ",")
vivos <- number(vivos, big.mark = ".", decimal.mark = ",")
# sobral
mortes_sobral <- number(mortes_sobral, big.mark = ".", decimal.mark = ",")
vivos_sobral <- number(vivos_sobral, big.mark = ".", decimal.mark = ",")
# ipu
mortes_ipu <- number(mortes_ipu, big.mark = ".", decimal.mark = ",")
vivos_ipu <- number(vivos_ipu, big.mark = ".", decimal.mark = ",")

## informações populacionais
# Santa Quitéria
pop_sq <- pop_micro_sobral[[20, 2]]
pop_sq <- number(pop_sq, big.mark = ".", decimal.mark = ",")
# Massapê
pop_mass <- pop_micro_sobral[[12, 2]]
pop_mass <- number(pop_mass, big.mark = ".", decimal.mark = ",")
```

```{r}
#| message: false
#| warning: false
#| echo: false
#| label: Mapa de Calor Hierárquico
ce_municipios |> 
  ggplot()+
  geom_sf(aes(fill = populacao), color = "white", size = 0.1) +
  scale_fill_viridis_c(option = "turbo", labels = comma) +
  labs(
    title = "Distribuição populacional da Microrregião de Sobral",
    fill = "População"
  ) +
  theme_void()
```
## Natalidade e mortalidade
A microrrgião de Sobral de 2024 a 2025 registrou `r mortes` mil mortes e `r vivos` mil nascidos vivos.Entre os municípios, Sobral lidera em número de mortos (`r mortes_sobral` mil) e de nascidos vivos (`r vivos_sobral`). Ipú, por sua vez, figura como segundo, com `r mortes_ipu` mortos e `r vivos_ipu` nascidos vivos. Pacujá, por outro lado, registrou `r mortes_pacuja` mortes e `r vivos_pacuja` nascidos vivos. Observa-se, portanto, que essas duas informações - nascidos vivos e número de mortos - em geral acaba seguindo aquela lista dos mais populosos para os com menos habitantes. (https://www.saude.ce.gov.br/tabnet-ceara/sim/ ; https://www.saude.ce.gov.br/tabnet-ceara/sinasc/)

Uma diferença que vale ser mencionada é que, embora Santa Quitéria seja o terceiro mais populoso, ela perde para Massapê nesses números, embora por um diferença muito pequena. São cidades com um quantitativo populacional próximo também: Santa Quitéria com `r pop_sq` e Massapê com `r pop_mass`, como estava expresso no gráfico anterior. (https://sidra.ibge.gov.br/tabela/6579)

Em razão dessa grande quantidade de nascidos vivos e mortes em Sobral, esperamos que essa cidade concentre um quantitativo maior de equipamentos de saúde; enquanto Pacujá sofra o efeito contrário e que esse padrão se repita para os outros municípios.



```{r}
#| label: gráfico de dispersão com nascidos vivos por mortos em cada município
#| echo: false
#| warning: false
#| message: false
mort_nascidos_vivos_micro_sobral |> 
  ggplot(
    aes(x = nascidos_vivos, y = mortes)
  )+
  geom_point(color = "black", size = 2) +
  geom_text_repel(
    data = subset(mort_nascidos_vivos_micro_sobral, municipio %in% c("Sobral", "Ipu", "Massapê", "Santa Quitéria", "Pacujá")),
    aes(label = municipio),
    size = 3
  )+
  labs(
    title = "Relação entre nascidos vivos e mortos por município",
    x = "Nascidos vivos",
    y = "Mortes"
  )+
  theme_minimal()+
  theme(
    plot.title = element_text(size = 14, face = "bold"),
    axis.title = element_text(size = 12)
  )+
  scale_x_log10()+
  scale_y_log10()+
  scale_color_viridis_d()
```
 

# Equipamentos
```{r}
#| echo: false

# tratando banco de dados sobre equipamentos
equipamentos <- equipamentos |>
  clean_names() |> 
  mutate(
    across(where(is.numeric), ~replace_na(.x, 0))
  ) |> 
  slice(-25)
```


```{r}
#| echo: false
# descritiva dos equipamentos
descritiva_equipamentos <- equipamentos |> 
  summarise(
    across(where(is.numeric), sum)
  ) 
```
Há um total de `r descritiva_equipamentos[[1, 30]]` equipamentos registrados. Eles são distribuídos em 29 categorias, conforme a tabela abaixo demonstra:

```{r}
#| echo: false
#| label: Equipamentos de saúde 

# tabela com distribuição dos equipamentos
tabela_descritiva_equipamentos <- descritiva_equipamentos |> 
  pivot_longer(
    cols = everything(),
    names_to = "Equipamento", 
    values_to = "Quantidade") 

knitr::kable(
  tabela_descritiva_equipamentos,
  format = "html", 
  caption = "Distribuição dos equipamentos"
)
```
```{r}
#| echo: false

# operações para texto
relacao_sobral_regiao <- equipamentos[[22, 31]] / tabela_descritiva_equipamentos[[30,2]]

relacao_sobral_regiao <- label_percent(accuracy = 0.1)(relacao_sobral_regiao)
 
```

Quanto à sua distribuição por município, observa-se uma predominância em Sobral, o qual concentra `r equipamentos[[22, 31]]` deles. Tal número representa `r relacao_sobral_regiao` daquele total. 

=> agrupar Ipu, Santa Quitéria
=> agrupar de santana à meruoca
=> agrupar de hidrolândia à moraújo
=> fazer gráfico de colunas para representar a distribuição dos equipamentos. Variáveis: tipo de equipamento, cidade, quantidade

 






