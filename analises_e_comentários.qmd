---
title: "Microrregião de Sobral"
lang: pt
format:
  html:
    toc: true
    number-sections: true
    toc-depth: 2
    embed-resources: true
bibliography: referencias.bib
csl: apa.csl
link-citations: true
---

```{r pacotes}
#| include: false
#| message: false
#| warning: false

library(tidyverse)
library(dplyr)
library(janitor)
library(sf)
library(scales)
library(geobr)
library(readr)
library(plotly)
library(ggrepel)
library(viridis)
library(knitr)
library(tidyr)
library(psych)
library(apaTables)
```

```{r}
#| include: false
#| message: false
#| warning: false
#| label: "Importação"
# chamando banco de dados

# população do ceará
ce_municipios <- read_municipality(code_muni = "CE", year = 2024)

# população da micro sobral
pop_micro_sobral <- read_csv2("data/pop_ce_censo_2022_limpo.csv")

# mortalidade da micro sobral
mort_nascidos_vivos_micro_sobral <- read_csv2("data/mort_e_nascidosvivos_micro_sobral.csv") 

# equipamentos
equipamentos <- read_csv2("data/equipamentos_limpo.csv")

#idade e sexo
  pop_idade_sexo <- read.csv("data/pop_idade_sexo - Página1.csv")
```

```{r tratamento_dos_dados}
#| include: false
#| message: false
#| warning: false
knitr::opts_chunk$set(echo = FALSE)

# população dos municípios da micro sobral
pop_micro_sobral <- pop_micro_sobral |> 
  clean_names() |> 
  as_tibble() |> 
  mutate(
    municipio = str_to_title(municipio),
    populacao = as.numeric(populacao),
    municipio = case_when(municipio == "Ipú" ~ "Ipu",
                           TRUE ~ municipio)
  ) |> 
  select(municipio, populacao)
   
# juntando bancos de dados
ce_municipios <- ce_municipios |> 
  mutate(
    name_muni = str_to_title(name_muni)) |> 
  inner_join(pop_micro_sobral, by = c("name_muni" = "municipio"))

#----

# banco de número de mortos e nascidos vivos
mort_nascidos_vivos_micro_sobral <- mort_nascidos_vivos_micro_sobral |> 
  clean_names()

mort_nascidos_vivos_micro_sobral |> 
   summarise(
    qde_morte_micro_sobral = sum(mort_nascidos_vivos_micro_sobral$qde_morte_micro_sobral),
    qde_nascidos_vivos_micro_sobral = sum(mort_nascidos_vivos_micro_sobral$qde_nascidos_vivos_micro_sobral)
  )

# idade e sexo
pop_idade_sexo$indice_envelhecimento <- gsub(",", ".", pop_idade_sexo$indice_envelhecimento)
# porcentagem de cada faixa etária nos municípios
pop_idade_sexo <- pop_idade_sexo |>
  mutate(
    perc_jovens = round((jovens_total/pop_total)*100, 2),
    perc_ativos = round((pop_ativa_total/pop_total)*100, 2),
    perc_idosos = round((idosos_total/pop_total)*100, 2)
  )

# tratando banco de dados sobre equipamentos
equipamentos <- equipamentos |>
  clean_names() |> 
  mutate(
    across(where(is.numeric), ~replace_na(.x, 0))
  ) |> 
  slice(-25)

equipamentos <- equipamentos |>
  select(
    "Posto de saúde" = posto_de_saude,
    "UBS/CSF" = centro_de_saude_unidade_basica,
    "Policlínica" = policlinica,
    "Hospital geral" = hospital_geral,
    "Hospital especializado" = hospital_especializado,
    "Academia da saúde" = polo_academia_da_saude,
    "Centro de atenção psicossocial" = centro_de_atencao_psicossocial,
    "Unidade de atenção à saúde indígena" = unidade_de_atencao_a_saude_indigena,
    "Farmácia" = farmacia,
    "Consultório isolado" = consultorio_isolado,
    "Centro de especialidade" = clinica_centro_de_especialidade,
    "Unidade de apoio (diagnose e terapia)" = unidade_de_apoio_diagnose_e_terapia_sadt_isolado,
    "Central de gestão em saúde" = central_de_gestao_em_saude,
    "SAMU" = unidade_movel_de_nivel_pre0hospitalar_na_area_de_urgencia,
    "Unidade móvel terrestre" = unidade_movel_terrestre,
    "Unidade mista" = unidade_mista,
    "Unidade de vigilância em saúde" = unidade_de_vigilancia_em_saude,
    "Centro de parto normal" = centro_de_parto_normal_0_isolado,
    "Centro de atenção em hemoterapia e/ou hematologica" = centro_de_atencao_hemoterapia_e_ou_hematologica,
    "Centro de apoio a saúde da família" = centro_de_apoio_a_saude_da_familia,
    "Pronto atendimento" = pronto_atendimento,
    "Central de regulação médica das urgências" = central_de_regulacao_medica_das_urgencias,
    "Serviço de atenção domiciliar" = servico_de_atencao_domiciliar_isolado_home_care,
    "Lab. de saúde pública" = laboratorio_de_saude_publica,
    "Central de regulação do acesso" = central_de_regulacao_do_acesso,
    "Central de notif., capt. e dist. de órgãos estaduais" = central_de_notificacao_captacao_e_distrib_de_orgaos_estadual,
    "Polo de prevenção de doenças e agravos e promoção da saúde" = polo_de_prevencao_de_doencas_e_agravos_e_promocao_da_saude,
    "Central de abastecimento" = central_de_abastecimento,
    "Centro de imunização" = centro_de_imunizacao,
    everything()
  )
```

```{r}
#| include: false
#| message: false
#| warning: false
#| label: "Análises"
# análise descritiva
tabela_descritiva_pop <- pop_micro_sobral |> 
  summarise(
    "Quantidade de municípios" = n(),
    "População total" = sum(populacao),
    "Média" = mean(populacao),
    "Mediana" = median(populacao), 
    "Desvio padrão" = sd(populacao),
    "Valor mínimo" = min(populacao),
    "Valor máximo" = max(populacao)
  )

# análise descritiva dos equipamentos

descritiva_equipamentos <- equipamentos |> 
  summarise(
    across(where(is.numeric), sum)
  ) 

```

# Aspectos gerais

```{r}
#| echo: false

 a <- 658665/9233656
 a <- label_percent(accuracy = 0.001)(a)
```

A microrregião de Sobral é composta por 24 municípios. São eles: Alcântaras, Cariré, Catunda, Coreaú, Forquilha, Frecheirinha, Graça, Groaíras, Hidrolândia, Ipu, Irauçuba, Massapê, Meruoca, Moraújo, Mucambo, Pacujá, Pires Ferreira, Reriutaba, Santa Quitéria, Santana Do Acaraú, Senador Sá, Sobral, Uruoca e Varjota. Tais municípios totalizam 658.665 mil em termos populacionais o que representa 39,2% da população da macrorregião norte (1.679.525 milhões) e em torno de `r a` da população do Ceará (9.233.656 milhões). (https://sidra.ibge.gov.br/tabela/6579).

```{r}
#| message: false
#| warning: false
#| echo: false
#| label: "Descritiva da população - tabela"

tabela_descritiva_pop <- tabela_descritiva_pop |> 
  pivot_longer(
    cols = everything(),
    names_to = "Indicador Demográfico", 
    values_to = "Valor (habitantes)"
  ) |> 
  mutate(`Valor (habitantes)` = format(`Valor (habitantes)`, 
                                      big.mark = ".", 
                                      decimal.mark = ",", 
                                      scientific = FALSE))

kable(
  tabela_descritiva_pop,
  format = "html",
  align = c("l", "r"),
  digits = 2,
  caption = "Tabela 1 - Estatísticas descritivas da população dos municípios da microrregião de Sobral.",
  col.names = c("Indicador Demográfico", "Valor (habitantes)")
)

```


## Gênero e distribuição populacional

Quando se realiza o recorte de gênero, nota-se que não há uma grande discrepância entre o quantitativo de homens (49%) e mulheres (51%) na microrregião de sobral. Sobral constitui o mais populoso dentre eles com 215.286 mil habitantes. Ipu o segundo lugar nesse posto com uma poulação estimada em 42.968 mil. Pacujá, por outro lado, tem a menor população que gira em torno de 6.345 mil habitantes [@ibge_populacao_2025].

A partir desses dados, constata-se uma desigual distribuição populacional. Tal discrepância pode ser verificada ao se ater à diferença já entre Ipú e Sobral que é de 172.318. Quando comparado com o menor município em termos populacionais (Pacujá), a diferença sobe para 208.941.


```{r tabelas}
#| message: false
#| warning: false
#| echo: false
#| label: "Gráfico de colunas"

#gráfico de colunas
gra_col <- pop_micro_sobral |> 
  mutate(populacao_formatada = format(populacao, big.mark = ".", decimal.mark = ",")) |> 
  ggplot(
    aes(x = populacao,
        y = reorder(municipio, populacao),
        text = paste("Município:", municipio, "<br>População:", populacao_formatada)),
    color = "white"
  )+
  geom_col(fill = "grey")+
  labs(
    title = "Distribuição populacional por município",
    x = "População",
    y = "Municípios"
  )+
  # remover espaçamento entre o nome dos municípios e as colunas
  scale_x_continuous(expand = c(0,0),
                     breaks = c(6345, 42968, 215286),
                     limits = c(0, max(pop_micro_sobral$populacao)*1.02))+
  # remover fundo quadriculado
  theme(
    panel.background = element_blank(),
    axis.line.y = element_line(),
    axis.title.y = element_text(margin = margin(r = 15)),
    plot.margin = margin(l = 100, r = 20),
    axis.line.x = element_line()
  )
# tranformar em gráfico interativo
gra_col_int <- ggplotly(gra_col, tooltip = "text") |> 
  layout(margin = list(l = 120, r = 50, t = 50, b = 50),
         yaxis = list(
           title = list(standoff = 10)
         ))
gra_col_int
```

```{r}
#| echo: false
#| label: "Variáveis para texto"
mortes <- sum(mort_nascidos_vivos_micro_sobral$mortes)
vivos <- sum(mort_nascidos_vivos_micro_sobral$nascidos_vivos)
# sobral
mortes_sobral <- mort_nascidos_vivos_micro_sobral[[22, 2]]
vivos_sobral <- mort_nascidos_vivos_micro_sobral[[22, 3]]
# ipu
mortes_ipu <- mort_nascidos_vivos_micro_sobral[[10, 2]]
vivos_ipu <- mort_nascidos_vivos_micro_sobral[[10, 3]]
# pacujá
mortes_pacuja <- mort_nascidos_vivos_micro_sobral[[16, 2]]
vivos_pacuja <- mort_nascidos_vivos_micro_sobral[[16, 3]]

## formatar para texto
# geral
mortes <- number(mortes, big.mark = ".", decimal.mark = ",")
vivos <- number(vivos, big.mark = ".", decimal.mark = ",")
# sobral
mortes_sobral <- number(mortes_sobral, big.mark = ".", decimal.mark = ",")
vivos_sobral <- number(vivos_sobral, big.mark = ".", decimal.mark = ",")
# ipu
mortes_ipu <- number(mortes_ipu, big.mark = ".", decimal.mark = ",")
vivos_ipu <- number(vivos_ipu, big.mark = ".", decimal.mark = ",")

## informações populacionais
# Santa Quitéria
pop_sq <- pop_micro_sobral[[20, 2]]
pop_sq <- number(pop_sq, big.mark = ".", decimal.mark = ",")
# Massapê
pop_mass <- pop_micro_sobral[[12, 2]]
pop_mass <- number(pop_mass, big.mark = ".", decimal.mark = ",")
```

```{r}
#| message: false
#| warning: false
#| echo: false
#| label: "Mapa de Calor Hierárquico"
ce_municipios |> 
  ggplot()+
  geom_sf(aes(fill = populacao), color = "white", size = 0.1) +
  scale_fill_viridis_c(option = "turbo", labels = comma) +
  labs(
    title = "Distribuição populacional da Microrregião de Sobral",
    fill = "População"
  ) +
  theme_void()
```

## Natalidade e mortalidade

A microrregião de Sobral de 2024 a 2025 registrou `r mortes` mil mortes e `r vivos` mil nascidos vivos.Entre os municípios, Sobral lidera em número de mortos (`r mortes_sobral` mil) e de nascidos vivos (`r vivos_sobral`). Ipú, por sua vez, figura como segundo, com `r mortes_ipu` mortos e `r vivos_ipu` nascidos vivos. Pacujá, por outro lado, registrou `r mortes_pacuja` mortes e `r vivos_pacuja` nascidos vivos. Observa-se, portanto, que essas duas informações - nascidos vivos e número de mortos - em geral acaba seguindo aquela lista dos mais populosos para os com menos habitantes [@saude_ce_mortalidade_2025; @saude_ce_natalidade_2025].

Uma diferença que vale ser mencionada é que, embora Santa Quitéria seja o terceiro mais populoso, ela perde para Massapê nesses números, embora por um diferença muito pequena. São cidades com um quantitativo populacional próximo também: Santa Quitéria com `r pop_sq` e Massapê com `r pop_mass`, como estava expresso no gráfico anterior [@ibge_populacao_2025]

Em razão dessa grande quantidade de nascidos vivos e mortes em Sobral, esperamos que essa cidade concentre um quantitativo maior de equipamentos de saúde; enquanto Pacujá sofra o efeito contrário e que esse padrão se repita para os outros municípios.

```{r}
#| label: "gráfico de dispersão com nascidos vivos por mortos em cada município"
#| echo: false
#| warning: false
#| message: false
mort_nascidos_vivos_micro_sobral |> 
  ggplot(
    aes(x = nascidos_vivos, y = mortes)
  )+
  geom_point(color = "black", size = 2) +
  geom_text_repel(
    data = subset(mort_nascidos_vivos_micro_sobral, municipio %in% c("Sobral", "Ipu", "Massapê", "Santa Quitéria", "Pacujá")),
    aes(label = municipio),
    size = 3
  )+
  labs(
    title = "Relação entre nascidos vivos e mortos por município",
    x = "Nascidos vivos",
    y = "Mortes"
  )+
  theme_minimal()+
  theme(
    plot.title = element_text(size = 14, face = "bold"),
    axis.title = element_text(size = 12)
  )+
  scale_x_log10()+
  scale_y_log10()+
  scale_color_viridis_d()
```

# Equipamentos

Há um total de `r descritiva_equipamentos[[1, 30]]` equipamentos registrados. Eles são distribuídos em 29 categorias, conforme a tabela abaixo demonstra:

```{r}
#| echo: false
#| label: Equipamentos de saúde 

# tabela com distribuição dos equipamentos
tabela_descritiva_equipamentos <- descritiva_equipamentos |> 
  pivot_longer(
    cols = everything(),
    names_to = "Equipamento", 
    values_to = "Quantidade") 

knitr::kable(
  tabela_descritiva_equipamentos,
  format = "html", 
  caption = "Distribuição dos equipamentos"
)
```

```{r}
#| echo: false

# operações para texto
# sobral
relacao_sobral_regiao <- equipamentos[[22, 31]] / tabela_descritiva_equipamentos[[30,2]]

relacao_sobral_regiao <- label_percent(accuracy = 0.1)(relacao_sobral_regiao)
# ipu e santa quitéria
relacao_ipu_sq_regiao <- equipamentos[[10, 31]] + equipamentos[[20, 31]]
relacao_ipu_sq_regiao <- relacao_ipu_sq_regiao / tabela_descritiva_equipamentos[[30,2]]

relacao_ipu_sq_regiao <- label_percent(accuracy = 0.1)(relacao_ipu_sq_regiao)
# Santana à Meruoca
relacao_santana_a_meruoca_regiao <- equipamentos |> 
  filter(municipio %in% c("SANTANA DO ACARAU", "MASSAPE", "VARJOTA", "FORQUILHA", "IRAUCUBA", "RERIUTABA", "MERUOCA")) |> 
  summarise(soma = sum(total, na.rm = T)) |> 
  pull()

total_geral <- sum(equipamentos$total, na.rm = T)

relacao_santana_a_meruoca_regiao <- percent(relacao_santana_a_meruoca_regiao/ total_geral, accuracy = 0.1)

# Hidrolândia à Moraújo
relacao_hidro_a_moraujo_regiao <- equipamentos |> 
  select(municipio, total) |> 
  arrange(total) |> 
  slice(1:14) |> 
  summarise(soma = sum(total, na.rm = T)) |> 
  pull()

relacao_hidro_a_moraujo_regiao <- percent(relacao_hidro_a_moraujo_regiao/total_geral, accuracy = 0.1)

```

Quanto à sua distribuição por município, observa-se uma predominância em Sobral, o qual concentra `r equipamentos[[22, 31]]` deles. Tal número representa `r relacao_sobral_regiao` daquele total. Quando comparado com Ipu (48 dispositivos), há uma diferença expressiva de `r equipamentos[[22, 31]] - equipamentos[[10, 31]]`. Entretanto, não se vê uma discrepância desse nível entre Ipu e Santa Quitéria, que é a terceira cidade com maior quantidade desses estabelecimentos (`r equipamentos[[20, 31]]`). Juntas, essas duas cidades representam `r relacao_ipu_sq_regiao`.

Em seguida vêm Santana do Acaraú (`r equipamentos[[19, 31]]`), Massapê (`r equipamentos[[12, 31]]`), Varjota (`r equipamentos[[24, 31]]`), Forquilha (`r equipamentos[[5, 31]]`), Irauçuba (`r equipamentos[[11, 31]]`), Reriutaba (`r equipamentos[[18, 31]]`), Meruoca (`r equipamentos[[13, 31]]`). As sete cidades compõem `r relacao_santana_a_meruoca_regiao` do total de equipamentos. Os demais municípios variam entre 20 a 11 quanto a esse número, sendo representante de `r relacao_hidro_a_moraujo_regiao` na região analisada. Seus municípios individuais são: Hidrolândia (`r equipamentos[[9, 31]]`), Groaíras (`r equipamentos[[8, 31]]`), Frecheirinha (`r equipamentos[[6, 31]]`), Coreaú (`r equipamentos[[4, 31]]`), Cariré (`r equipamentos[[2, 31]]`), Uruoca (`r equipamentos[[23, 31]]`), Graça (`r equipamentos[[7, 31]]`), Mucambo (`r equipamentos[[15, 31]]`), Alcântaras (`r equipamentos[[1, 31]]`), Catunda (`r equipamentos[[3, 31]]`), Pires Ferreira (`r equipamentos[[17, 31]]`), Pacujá (`r equipamentos[[16, 31]]`), Senador Sá (`r equipamentos[[21, 31]]`), Moraújo (`r equipamentos[[14, 31]]`).

=\> Gráfico da quantidade de equipamentos

Portanto, observa-se que a distribuição dos equipamentos acompanha aquela tendência populacional assim como a relação entre nascidos vivos e mortes. Sobral lidera todos esses indicativos, sendo seguido por Ipú, embora esta tenha indicadores muito distantes em relação à Sobral. Entretanto, quando comparada com Santa Quitéria, Santana do Acaraú ou Massapê, não se constata uma diferença tão expressiva quanto à Sobral. Na outro extremo, pacujá segue a tendência a acompanhar os menores números e, especificamente quanto ao número de equipamentos, Moraújo e Senador Sá apresentam menos, mas é diferença é de apenas 1.

=\> fazer gráfico de colunas para representar a distribuição dos equipamentos. Variáveis: tipo de equipamento, cidade, quantidade

# Referências

::: {#refs}
:::